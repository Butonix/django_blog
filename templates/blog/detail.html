{% extends 'blog/base.html' %}
{% load staticfiles %}
{% load blog_tags %}
{% load comment_tags %}
{% block site_info %}
<meta name="keywords" content="{{ keywords }}" />
<meta name="description" content="{{ description }}" />
<title>{{ title }}</title>
{% endblock site_info %}
{% block css %}
 <link rel="stylesheet" type="text/css" href="{% static 'blog/css/prism.css' %}" />
{% endblock css %}
{% block article %}
<div class="article">
    <div class="breadcrumbs">
        <a title="返回首页" href="/"><i class="fa fa-home"></i></a>
        <small> > </small>
        <a href="{% url 'blog:category' post.category.slug %}">{{ post.category.name }}</a>
        <small> > </small>
        <span>{{ post.title }}</span>
    </div>
    <header class="article-header">
        <h1 class="article-title">
            <a href="{{ post.get_absolute_url }}">{{ post.title }}</a>
        </h1>
        <div class="preem">
            <span>
                <i class="fa fa-list-alt"></i>
                <a href="{% url 'blog:category' post.category.slug %}">{{ post.category.name }}</a>
            </span>
            <span>
                <i class="fa fa-user"></i>
                <a href="javascript:void(0);">{{ post.author.username }}</a>
            </span>
            <span>
                <i class="fa fa-clock-o"></i>
                {{ post.date_created|timesince }}
            </span>
            <span>
                <i class="fa fa-eye"></i>
                {{ post.click_count }}
            </span>
            <span>
                <i class="fa fa-comment-o"></i>
                <a href="">{{ post.comment_set.all.count }}评论</a>
            </span>
        </div>
    </header>
    <article class="article-content">
        {{ post.content|safe }}
    </article>
</div>
{% endblock article %}
{% block comment %}
<div class="pinglun" id="评论">
    <div class="comment-form-header">
        {% if request.user.is_authenticated %}
        <img src="{{ request.user.get_avatar_url }}">
        <div class="header-username">
            <span>
                {{ request.user.username }}
                <i class="fa fa-edit"></i>
            </span>
            <span style="color: #292b2c">回复：</span>
            <span style="color: #16a085">@Aaron</span>
        </div>
        {% else %}
        <span class="remind-login">尚未登录，请<a href="{% url 'account_login' %}?next={{ request.path }}">登录</a>后参与评论</span>
        {% endif %}
    </div>
    {% generate_form_for post as form %}
    <form class="comment-form" method="post" action="{% url 'easy_comment:submit_comment' %}">
        {% csrf_token %}
        {% for field in form %}
        {{ field }}
        {{ field.errors }}
        {% endfor %}
        <button class="button button-primary-flat button-rounded pull-right" type="submit" id="submit-button">
            <i class="fa fa-check-square-o"></i>
            提交评论
        </button>
    </form>
    <button class="button button-primary-flat button-rounded pull-right" id="cancel-button">
        <i class="fa fa-undo"></i>
        取消回复
    </button>
    <div class="clear"></div>
    <script type="text/javascript" src="{% static "ckeditor/ckeditor-init.js" %}"></script>
    <script type="text/javascript" src="{% static "ckeditor/ckeditor/ckeditor.js" %}"></script>
    <h2>
        评论
        <span class="pull-right">10人参与 | 200条评论</span>
    </h2>
    <div class="pinglun-list">
        {% generate_comment_list post as html %}
        {{ html|safe }}
    </div>
</div>
{% endblock %}
{% block sider %}
<div class="subblock" id="title_list">
    <h3>文章目录</h3>
    <ul>
        {{ title_tree|safe }}
        <li>
            <a href="#评论">评论</a>
        </li>
    </ul>
</div>
{% endblock sider %}
{% block script %}
<script src="/static/ckeditor/ckeditor/plugins/prism/lib/prism/prism_patched.min.js"></script>
<script type="text/javascript">
    $('.article-content').find(':header').each(function () {
        $(this).attr('id', $(this).text());
    });
    $('.article-content img').removeAttr('style');
    $('.pinglun-text img').removeAttr('style');
    $(".django-ckeditor-widget").removeAttr('style');
</script>
{% endblock script %}